#!/bin/sh
set -e
. /usr/share/debconf/confmodule

if [ "$1" = "configure" ]; then

  # creating videoserver group if it isn't already there
  if ! getent group videoserver >/dev/null; then
    addgroup --system --force-badname --quiet videoserver
  fi

  # creating videoserver user if it isn't already there
  if ! getent passwd videoserver >/dev/null; then
    adduser --system --force-badname --quiet \
      --ingroup videoserver \
      --home /var/lib/videoserver \
      --shell /bin/false \
      videoserver
    usermod -c "videoserver WebRTC group" videoserver
  fi

  if ! test -d /var/lib/videoserver; then
    mkdir /var/lib/videoserver
    chown -R videoserver:videoserver /var/lib/videoserver
    # This directory can contain sensitive data and should not be world-readable
    chmod 0700 /var/lib/videoserver
  fi

  # Install and start daemon
  deb-systemd-invoke enable videoserver
  deb-systemd-invoke start videoserver
  exit 0
fi # End of configure

deb-systemd-invoke start videoserver