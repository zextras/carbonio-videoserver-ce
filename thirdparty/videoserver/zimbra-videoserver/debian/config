#!/bin/sh
# This has to be added where postinst file is present
# This file is responsible (together with templates and postins directives)
# of user interaction at postinst phase
set -e
. /usr/share/debconf/confmodule

db_input high videoserver/license
db_go
db_get videoserver/license

if [ $RET = "true" ]; then
  db_input high videoserver/public-ip
  db_go
  db_get videoserver/public-ip
  public_ip="$RET"
  api_secret="$(tr -dc 'a-zA-Z0-9' </dev/urandom | fold -w 32 | head -n 1)"
  sed -i "s/\${PUBLIC_IP_ADDRESS}/$public_ip/g" /etc/janus/janus.jcfg
  sed -i "s/\${API_SECRET}/$api_secret/g" /etc/janus/janus.jcfg
  db_subst videoserver/token API_SECRET "${api_secret}"
  db_subst videoserver/token PUBLIC_IP "${public_ip}"
  db_input high videoserver/token || true
  db_get videoserver/token
  db_go
fi
