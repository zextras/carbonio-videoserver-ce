#!/usr/bin/make -f
export DEB_BUILD_OPTIONS=nocheck

# Ensure rpath is set correctly
export DEB_CFLAGS_MAINT_APPEND  = -IOZCI
export DEB_LDFLAGS_MAINT_APPEND = -Wl,-rpath,OZCL -LOZCL
export PKG_CONFIG_PATH=OZCL/pkgconfig

%:
	dh $@ --parallel
override_dh_auto_configure:
	./autogen.sh
	./configure \
	--prefix OZC \
	--sysconfdir /etc \
	--disable-docs \
	--disable-turn-rest-api \
	--disable-all-transports \
	--enable-websockets \
	--disable-all-plugins \
	--enable-plugin-audiobridge \
	--enable-plugin-videoroom \
	--enable-post-processing \
	--disable-all-handlers \
	--enable-websockets-event-handler \
	--disable-json-logger

override_dh_strip:
	dh_strip -pzimbra-videoserver
	dh_strip -Nzimbra-videoserver -Nzimbra-videoserver

override_dh_auto_install:
	make DESTDIR=$$(pwd)/debian/tmp install configs
	install -Dm644 -t $$(pwd)/debian/tmp/lib/systemd/system/ $$(pwd)/debian/videoserver.service
